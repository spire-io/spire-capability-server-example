<html>
  <head>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/spire.io.bundle.js"></script>
    <script type="text/javascript">
      $(function(){
        var Spire = require('./spire.io.js');
        var spire = new Spire({key: 'dummy key'});
        spire.connect(function(){
          $.get('/discover', function(data){
            var spireSubscription = data.subscription;
            var spireChannel = data.channel;

            var get = function(){
              spire.requests.subscriptions.get(
                {subscription: spireSubscription},
                function(err, data){
                  $('.emesrever').val(data.messages[0].content);
                  get();
                }
              );
            };
            get();

            $('.loading').hide();
            $('.content').show();
        
            $('.submit.button').click(function(e){
              e.stopPropagation();
              e.preventDefault();
              spire.requests.messages.create({
                channel: spireChannel,
                content: $('.reverseme').val()
              },
              function(err, msg){
                console.log('Sent message: ', msg);
              }
            );
            });
          });
        });
      });
    </script>
  </head>
  <body>
    <h2 class="loading">Loading...</h2>
    <div class="content" style="display:none">
      <textarea class="reverseme" type="text"></textarea>
      <br />
      <a href="#" class="submit button">reverse me!</a>
      <br />
      <textarea class="emesrever">
      </textarea>
    </div>
  </body>
</html>
